{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport React, { useState, useCallback, useRef } from 'react';\nimport addStyle from 'dom-lib/addStyle';\nimport addClass from 'dom-lib/addClass';\nimport removeClass from 'dom-lib/removeClass';\nimport omit from 'lodash/omit';\nimport merge from 'lodash/merge';\nimport { SCROLLBAR_WIDTH, SORT_TYPE } from '../constants';\nimport useControlled from './useControlled';\nimport getTableColumns from './getTableColumns';\nimport getTotalByColumns from './getTotalByColumns';\nimport getColumnProps from './getColumnProps';\nimport useUpdateEffect from './useUpdateEffect';\nimport flushSync from './flushSync';\nimport useMount from './useMount';\n/**\n * Attach rendering-related attributes to all cells of the form and cache them.\n * @param props\n * @returns\n */\n\nvar useCellDescriptor = function useCellDescriptor(props) {\n  var children = props.children,\n      rtl = props.rtl,\n      mouseAreaRef = props.mouseAreaRef,\n      tableRef = props.tableRef,\n      minScrollX = props.minScrollX,\n      scrollX = props.scrollX,\n      tableWidth = props.tableWidth,\n      headerHeight = props.headerHeight,\n      showHeader = props.showHeader,\n      sortTypeProp = props.sortType,\n      defaultSortType = props.defaultSortType,\n      sortColumn = props.sortColumn,\n      rowHeight = props.rowHeight,\n      onSortColumn = props.onSortColumn,\n      onHeaderCellResize = props.onHeaderCellResize,\n      prefix = props.prefix;\n\n  var _useControlled = useControlled(sortTypeProp, defaultSortType),\n      sortType = _useControlled[0],\n      setSortType = _useControlled[1];\n\n  var _useState = useState(),\n      cacheData = _useState[0],\n      setCacheData = _useState[1];\n\n  var clearCache = useCallback(function () {\n    setCacheData(null);\n  }, []);\n  var setColumnResizing = useCallback(function (resizing) {\n    if (!tableRef.current) {\n      return;\n    }\n\n    if (resizing) {\n      addClass(tableRef.current, prefix('column-resizing'));\n    } else {\n      removeClass(tableRef.current, prefix('column-resizing'));\n    }\n  }, [prefix, tableRef]);\n  var columnWidths = useRef({});\n  useMount(function () {\n    // As the cells are cached before the table width is updated, it is necessary to clear the cache again. fix: #430\n    clearCache();\n  });\n  useUpdateEffect(function () {\n    clearCache();\n  }, [children, sortColumn, sortType, tableWidth.current, scrollX.current, minScrollX.current]);\n  useUpdateEffect(function () {\n    columnWidths.current = {};\n  }, [children]);\n  var handleColumnResizeEnd = useCallback(function (columnWidth, _cursorDelta, dataKey, index) {\n    columnWidths.current[dataKey + \"_\" + index + \"_width\"] = columnWidth;\n    setColumnResizing(false);\n\n    if (mouseAreaRef.current) {\n      addStyle(mouseAreaRef.current, {\n        display: 'none'\n      });\n    } // fix: https://github.com/rsuite/rsuite-table/issues/398\n\n\n    flushSync(function () {\n      return clearCache();\n    });\n    onHeaderCellResize === null || onHeaderCellResize === void 0 ? void 0 : onHeaderCellResize(columnWidth, dataKey);\n  }, [clearCache, mouseAreaRef, onHeaderCellResize, setColumnResizing]);\n  var handleColumnResizeMove = useCallback(function (width, left, fixed) {\n    var mouseAreaLeft = width + left;\n    var x = mouseAreaLeft;\n    var dir = 'left';\n\n    if (rtl) {\n      mouseAreaLeft += minScrollX.current + SCROLLBAR_WIDTH;\n      dir = 'right';\n    }\n\n    if (!fixed) {\n      x = mouseAreaLeft + (rtl ? -scrollX.current : scrollX.current);\n    }\n\n    if (mouseAreaRef.current) {\n      var _addStyle;\n\n      addStyle(mouseAreaRef.current, (_addStyle = {\n        display: 'block'\n      }, _addStyle[dir] = x + \"px\", _addStyle));\n    }\n  }, [minScrollX, mouseAreaRef, rtl, scrollX]);\n  var handleColumnResizeStart = useCallback(function (width, left, fixed) {\n    setColumnResizing(true);\n    handleColumnResizeMove(width, left, fixed);\n  }, [handleColumnResizeMove, setColumnResizing]);\n  var handleSortColumn = useCallback(function (dataKey) {\n    var nextSortType = sortType;\n\n    if (sortColumn === dataKey) {\n      nextSortType = sortType === SORT_TYPE.ASC ? SORT_TYPE.DESC : SORT_TYPE.ASC;\n      setSortType(nextSortType);\n    }\n\n    onSortColumn === null || onSortColumn === void 0 ? void 0 : onSortColumn(dataKey, nextSortType);\n  }, [onSortColumn, setSortType, sortColumn, sortType]);\n\n  if (cacheData) {\n    return cacheData;\n  }\n\n  var hasCustomTreeCol = false;\n  var left = 0; // Cell left margin\n\n  var headerCells = []; // Table header cell\n\n  var bodyCells = []; // Table body cell\n\n  if (!children) {\n    var _cacheCell = {\n      columns: [],\n      headerCells: headerCells,\n      bodyCells: bodyCells,\n      hasCustomTreeCol: hasCustomTreeCol,\n      allColumnsWidth: left\n    };\n    setCacheData(_cacheCell);\n    return _cacheCell;\n  }\n\n  var columns = getTableColumns(children);\n  var count = columns.length;\n\n  var _getTotalByColumns = getTotalByColumns(columns),\n      totalFlexGrow = _getTotalByColumns.totalFlexGrow,\n      totalWidth = _getTotalByColumns.totalWidth;\n\n  React.Children.forEach(columns, function (column, index) {\n    if ( /*#__PURE__*/React.isValidElement(column)) {\n      var _columnWidths$current;\n\n      var columnChildren = column.props.children;\n      var columnProps = getColumnProps(column);\n      var _width = columnProps.width,\n          resizable = columnProps.resizable,\n          flexGrow = columnProps.flexGrow,\n          minWidth = columnProps.minWidth,\n          onResize = columnProps.onResize,\n          treeCol = columnProps.treeCol;\n\n      if (treeCol) {\n        hasCustomTreeCol = true;\n      }\n\n      if (columnChildren.length !== 2) {\n        throw new Error(\"Component <HeaderCell> and <Cell> is required, column index: \" + index + \" \");\n      }\n\n      var headerCell = columnChildren[0];\n      var cell = columnChildren[1];\n      var currentWidth = (_columnWidths$current = columnWidths.current) === null || _columnWidths$current === void 0 ? void 0 : _columnWidths$current[cell.props.dataKey + \"_\" + index + \"_width\"];\n      var cellWidth = currentWidth || _width || 0;\n\n      if (tableWidth.current && flexGrow && totalFlexGrow) {\n        var grewWidth = Math.max((tableWidth.current - totalWidth) / totalFlexGrow * flexGrow, minWidth || 60);\n        /**\n         * resizable = false, width will be recalc when table render.\n         * resizable = true, only first render will use grewWidth.\n         */\n\n        cellWidth = resizable ? currentWidth || grewWidth : grewWidth;\n      }\n\n      var cellProps = _extends({}, omit(columnProps, ['children']), {\n        'aria-colindex': index + 1,\n        left: left,\n        headerHeight: headerHeight,\n        key: index,\n        width: cellWidth,\n        height: typeof rowHeight === 'function' ? rowHeight() : rowHeight,\n        firstColumn: index === 0,\n        lastColumn: index === count - 1\n      });\n\n      if (showHeader && headerHeight) {\n        var headerCellProps = {\n          // Resizable column\n          // `index` is used to define the serial number when dragging the column width\n          index: index,\n          dataKey: cell.props.dataKey,\n          isHeaderCell: true,\n          minWidth: columnProps.minWidth,\n          sortable: columnProps.sortable,\n          onSortColumn: handleSortColumn,\n          sortType: sortType,\n          sortColumn: sortColumn,\n          flexGrow: resizable ? undefined : flexGrow\n        };\n\n        if (resizable) {\n          merge(headerCellProps, {\n            onResize: onResize,\n            onColumnResizeEnd: handleColumnResizeEnd,\n            onColumnResizeStart: handleColumnResizeStart,\n            onColumnResizeMove: handleColumnResizeMove\n          });\n        }\n\n        headerCells.push( /*#__PURE__*/React.cloneElement(headerCell, _extends({}, cellProps, headerCellProps)));\n      }\n\n      bodyCells.push( /*#__PURE__*/React.cloneElement(cell, cellProps));\n      left += cellWidth;\n    }\n  });\n  var cacheCell = {\n    columns: columns,\n    headerCells: headerCells,\n    bodyCells: bodyCells,\n    allColumnsWidth: left,\n    hasCustomTreeCol: hasCustomTreeCol\n  };\n  setCacheData(cacheCell);\n  return cacheCell;\n};\n\nexport default useCellDescriptor;","map":{"version":3,"sources":["/Users/danilnagovicyn/Desktop/reactprojects/Incubator/Samurai_way/samurai-way/node_modules/rsuite-table/es/utils/useCellDescriptor.js"],"names":["_extends","React","useState","useCallback","useRef","addStyle","addClass","removeClass","omit","merge","SCROLLBAR_WIDTH","SORT_TYPE","useControlled","getTableColumns","getTotalByColumns","getColumnProps","useUpdateEffect","flushSync","useMount","useCellDescriptor","props","children","rtl","mouseAreaRef","tableRef","minScrollX","scrollX","tableWidth","headerHeight","showHeader","sortTypeProp","sortType","defaultSortType","sortColumn","rowHeight","onSortColumn","onHeaderCellResize","prefix","_useControlled","setSortType","_useState","cacheData","setCacheData","clearCache","setColumnResizing","resizing","current","columnWidths","handleColumnResizeEnd","columnWidth","_cursorDelta","dataKey","index","display","handleColumnResizeMove","width","left","fixed","mouseAreaLeft","x","dir","_addStyle","handleColumnResizeStart","handleSortColumn","nextSortType","ASC","DESC","hasCustomTreeCol","headerCells","bodyCells","_cacheCell","columns","allColumnsWidth","count","length","_getTotalByColumns","totalFlexGrow","totalWidth","Children","forEach","column","isValidElement","_columnWidths$current","columnChildren","columnProps","_width","resizable","flexGrow","minWidth","onResize","treeCol","Error","headerCell","cell","currentWidth","cellWidth","grewWidth","Math","max","cellProps","key","height","firstColumn","lastColumn","headerCellProps","isHeaderCell","sortable","undefined","onColumnResizeEnd","onColumnResizeStart","onColumnResizeMove","push","cloneElement","cacheCell"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport React, { useState, useCallback, useRef } from 'react';\nimport addStyle from 'dom-lib/addStyle';\nimport addClass from 'dom-lib/addClass';\nimport removeClass from 'dom-lib/removeClass';\nimport omit from 'lodash/omit';\nimport merge from 'lodash/merge';\nimport { SCROLLBAR_WIDTH, SORT_TYPE } from '../constants';\nimport useControlled from './useControlled';\nimport getTableColumns from './getTableColumns';\nimport getTotalByColumns from './getTotalByColumns';\nimport getColumnProps from './getColumnProps';\nimport useUpdateEffect from './useUpdateEffect';\nimport flushSync from './flushSync';\nimport useMount from './useMount';\n\n/**\n * Attach rendering-related attributes to all cells of the form and cache them.\n * @param props\n * @returns\n */\nvar useCellDescriptor = function useCellDescriptor(props) {\n  var children = props.children,\n      rtl = props.rtl,\n      mouseAreaRef = props.mouseAreaRef,\n      tableRef = props.tableRef,\n      minScrollX = props.minScrollX,\n      scrollX = props.scrollX,\n      tableWidth = props.tableWidth,\n      headerHeight = props.headerHeight,\n      showHeader = props.showHeader,\n      sortTypeProp = props.sortType,\n      defaultSortType = props.defaultSortType,\n      sortColumn = props.sortColumn,\n      rowHeight = props.rowHeight,\n      onSortColumn = props.onSortColumn,\n      onHeaderCellResize = props.onHeaderCellResize,\n      prefix = props.prefix;\n\n  var _useControlled = useControlled(sortTypeProp, defaultSortType),\n      sortType = _useControlled[0],\n      setSortType = _useControlled[1];\n\n  var _useState = useState(),\n      cacheData = _useState[0],\n      setCacheData = _useState[1];\n\n  var clearCache = useCallback(function () {\n    setCacheData(null);\n  }, []);\n  var setColumnResizing = useCallback(function (resizing) {\n    if (!tableRef.current) {\n      return;\n    }\n\n    if (resizing) {\n      addClass(tableRef.current, prefix('column-resizing'));\n    } else {\n      removeClass(tableRef.current, prefix('column-resizing'));\n    }\n  }, [prefix, tableRef]);\n  var columnWidths = useRef({});\n  useMount(function () {\n    // As the cells are cached before the table width is updated, it is necessary to clear the cache again. fix: #430\n    clearCache();\n  });\n  useUpdateEffect(function () {\n    clearCache();\n  }, [children, sortColumn, sortType, tableWidth.current, scrollX.current, minScrollX.current]);\n  useUpdateEffect(function () {\n    columnWidths.current = {};\n  }, [children]);\n  var handleColumnResizeEnd = useCallback(function (columnWidth, _cursorDelta, dataKey, index) {\n    columnWidths.current[dataKey + \"_\" + index + \"_width\"] = columnWidth;\n    setColumnResizing(false);\n\n    if (mouseAreaRef.current) {\n      addStyle(mouseAreaRef.current, {\n        display: 'none'\n      });\n    } // fix: https://github.com/rsuite/rsuite-table/issues/398\n\n\n    flushSync(function () {\n      return clearCache();\n    });\n    onHeaderCellResize === null || onHeaderCellResize === void 0 ? void 0 : onHeaderCellResize(columnWidth, dataKey);\n  }, [clearCache, mouseAreaRef, onHeaderCellResize, setColumnResizing]);\n  var handleColumnResizeMove = useCallback(function (width, left, fixed) {\n    var mouseAreaLeft = width + left;\n    var x = mouseAreaLeft;\n    var dir = 'left';\n\n    if (rtl) {\n      mouseAreaLeft += minScrollX.current + SCROLLBAR_WIDTH;\n      dir = 'right';\n    }\n\n    if (!fixed) {\n      x = mouseAreaLeft + (rtl ? -scrollX.current : scrollX.current);\n    }\n\n    if (mouseAreaRef.current) {\n      var _addStyle;\n\n      addStyle(mouseAreaRef.current, (_addStyle = {\n        display: 'block'\n      }, _addStyle[dir] = x + \"px\", _addStyle));\n    }\n  }, [minScrollX, mouseAreaRef, rtl, scrollX]);\n  var handleColumnResizeStart = useCallback(function (width, left, fixed) {\n    setColumnResizing(true);\n    handleColumnResizeMove(width, left, fixed);\n  }, [handleColumnResizeMove, setColumnResizing]);\n  var handleSortColumn = useCallback(function (dataKey) {\n    var nextSortType = sortType;\n\n    if (sortColumn === dataKey) {\n      nextSortType = sortType === SORT_TYPE.ASC ? SORT_TYPE.DESC : SORT_TYPE.ASC;\n      setSortType(nextSortType);\n    }\n\n    onSortColumn === null || onSortColumn === void 0 ? void 0 : onSortColumn(dataKey, nextSortType);\n  }, [onSortColumn, setSortType, sortColumn, sortType]);\n\n  if (cacheData) {\n    return cacheData;\n  }\n\n  var hasCustomTreeCol = false;\n  var left = 0; // Cell left margin\n\n  var headerCells = []; // Table header cell\n\n  var bodyCells = []; // Table body cell\n\n  if (!children) {\n    var _cacheCell = {\n      columns: [],\n      headerCells: headerCells,\n      bodyCells: bodyCells,\n      hasCustomTreeCol: hasCustomTreeCol,\n      allColumnsWidth: left\n    };\n    setCacheData(_cacheCell);\n    return _cacheCell;\n  }\n\n  var columns = getTableColumns(children);\n  var count = columns.length;\n\n  var _getTotalByColumns = getTotalByColumns(columns),\n      totalFlexGrow = _getTotalByColumns.totalFlexGrow,\n      totalWidth = _getTotalByColumns.totalWidth;\n\n  React.Children.forEach(columns, function (column, index) {\n    if ( /*#__PURE__*/React.isValidElement(column)) {\n      var _columnWidths$current;\n\n      var columnChildren = column.props.children;\n      var columnProps = getColumnProps(column);\n      var _width = columnProps.width,\n          resizable = columnProps.resizable,\n          flexGrow = columnProps.flexGrow,\n          minWidth = columnProps.minWidth,\n          onResize = columnProps.onResize,\n          treeCol = columnProps.treeCol;\n\n      if (treeCol) {\n        hasCustomTreeCol = true;\n      }\n\n      if (columnChildren.length !== 2) {\n        throw new Error(\"Component <HeaderCell> and <Cell> is required, column index: \" + index + \" \");\n      }\n\n      var headerCell = columnChildren[0];\n      var cell = columnChildren[1];\n      var currentWidth = (_columnWidths$current = columnWidths.current) === null || _columnWidths$current === void 0 ? void 0 : _columnWidths$current[cell.props.dataKey + \"_\" + index + \"_width\"];\n      var cellWidth = currentWidth || _width || 0;\n\n      if (tableWidth.current && flexGrow && totalFlexGrow) {\n        var grewWidth = Math.max((tableWidth.current - totalWidth) / totalFlexGrow * flexGrow, minWidth || 60);\n        /**\n         * resizable = false, width will be recalc when table render.\n         * resizable = true, only first render will use grewWidth.\n         */\n\n        cellWidth = resizable ? currentWidth || grewWidth : grewWidth;\n      }\n\n      var cellProps = _extends({}, omit(columnProps, ['children']), {\n        'aria-colindex': index + 1,\n        left: left,\n        headerHeight: headerHeight,\n        key: index,\n        width: cellWidth,\n        height: typeof rowHeight === 'function' ? rowHeight() : rowHeight,\n        firstColumn: index === 0,\n        lastColumn: index === count - 1\n      });\n\n      if (showHeader && headerHeight) {\n        var headerCellProps = {\n          // Resizable column\n          // `index` is used to define the serial number when dragging the column width\n          index: index,\n          dataKey: cell.props.dataKey,\n          isHeaderCell: true,\n          minWidth: columnProps.minWidth,\n          sortable: columnProps.sortable,\n          onSortColumn: handleSortColumn,\n          sortType: sortType,\n          sortColumn: sortColumn,\n          flexGrow: resizable ? undefined : flexGrow\n        };\n\n        if (resizable) {\n          merge(headerCellProps, {\n            onResize: onResize,\n            onColumnResizeEnd: handleColumnResizeEnd,\n            onColumnResizeStart: handleColumnResizeStart,\n            onColumnResizeMove: handleColumnResizeMove\n          });\n        }\n\n        headerCells.push( /*#__PURE__*/React.cloneElement(headerCell, _extends({}, cellProps, headerCellProps)));\n      }\n\n      bodyCells.push( /*#__PURE__*/React.cloneElement(cell, cellProps));\n      left += cellWidth;\n    }\n  });\n  var cacheCell = {\n    columns: columns,\n    headerCells: headerCells,\n    bodyCells: bodyCells,\n    allColumnsWidth: left,\n    hasCustomTreeCol: hasCustomTreeCol\n  };\n  setCacheData(cacheCell);\n  return cacheCell;\n};\n\nexport default useCellDescriptor;"]},"metadata":{},"sourceType":"module"}